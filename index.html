<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Agenda</title>
    
    <!-- Tailwind CSS para Estilização -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React e ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel para transpilar JSX no navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Fontes Google -->
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #FDF6EC;
            overflow: hidden;
            margin: 0;
            user-select: none;
        }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #E8DFCA; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #D4E7C5; }

        /* Animações do Gato Mascote */
        .cat-svg { animation: idle-float 4s ease-in-out infinite; }
        .cat-tail-wag { animation: tail-wag 2s ease-in-out infinite alternate; transform-origin: left; }
        .cat-eye { animation: blink 5s infinite; }
        .cat-body-group { animation: cat-cycle 15s infinite; transform-origin: center center; }
        .cat-tongue { animation: tongue-lick 15s infinite; }
        .speech-bubble { animation: bubble-fade 8s infinite; }

        @keyframes idle-float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        @keyframes tail-wag {
            from { transform: rotate(-10deg); }
            to { transform: rotate(10deg); }
        }
        @keyframes blink {
            0%, 90%, 100% { transform: scaleY(1); }
            95% { transform: scaleY(0.1); }
        }
        @keyframes bubble-fade {
            0%, 5%, 35%, 100% { opacity: 0; transform: translateY(5px) scale(0.8); }
            10%, 30% { opacity: 1; transform: translateY(0) scale(1); }
        }
        @keyframes tongue-lick {
            0%, 40%, 46%, 100% { opacity: 0; transform: translateY(0); }
            41%, 45% { opacity: 1; transform: translateY(2px); }
        }
        @keyframes cat-cycle {
            0%, 35% { transform: rotate(0) scale(1); }
            40%, 50% { transform: rotate(-5deg); }
            55%, 70% { transform: rotate(360deg) scale(1.1); }
            75%, 100% { transform: rotate(0) scale(1); }
        }
        * { -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Código React em JSX -->
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // Ícones em SVG inline
        const IconCalendar = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>;
        const IconPlus = ({size=14}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;
        const IconCopy = ({size=11}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>;
        const IconTrash = ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>;
        const IconPencil = ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>;
        const IconGrip = ({size=12}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="9" cy="5" r="1"/><circle cx="9" cy="12" r="1"/><circle cx="9" cy="19" r="1"/><circle cx="15" cy="5" r="1"/><circle cx="15" cy="12" r="1"/><circle cx="15" cy="19" r="1"/></svg>;

        const DAYS_OF_WEEK = ['Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado', 'Domingo'];
        const MONTHS = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
        const PERIODS = [
            { id: 'manha', label: 'Manhã' },
            { id: 'tarde', label: 'Tarde' },
            { id: 'noite', label: 'Noite' }
        ];

        const FancyCat = () => (
            <div className="fixed bottom-4 right-8 pointer-events-none z-50 flex flex-col items-center">
                <div className="speech-bubble mb-2 px-4 py-2 bg-white rounded-2xl shadow-md border-2 border-[#E8DFCA] text-xs font-bold text-[#5D534A] relative">
                    Miau Miau! ✨
                    <div className="bubble-tail absolute -bottom-2 left-1/2 -translate-x-1/2 w-3 h-3 bg-white border-r-2 border-b-2 border-[#E8DFCA] rotate-45"></div>
                </div>
                <div className="cat-wrapper scale-125">
                    <svg width="100" height="80" viewBox="0 0 100 80" fill="none" className="cat-svg">
                        <ellipse cx="50" cy="70" rx="25" ry="5" fill="black" fillOpacity="0.05" />
                        <g className="cat-body-group">
                            <path className="cat-tail-wag" d="M70 50C85 50 90 40 85 30" stroke="#2D2D2D" strokeWidth="6" strokeLinecap="round" fill="none"/>
                            <rect x="25" y="40" width="50" height="25" rx="12" fill="#2D2D2D" />
                            <circle cx="35" cy="65" r="4" fill="#2D2D2D" /><circle cx="45" cy="65" r="4" fill="#2D2D2D" />
                            <circle cx="55" cy="65" r="4" fill="#2D2D2D" /><circle cx="65" cy="65" r="4" fill="#2D2D2D" />
                            <g className="cat-head-group">
                                <circle cx="30" cy="35" r="15" fill="#2D2D2D" />
                                <path d="M18 25L22 10L30 22" fill="#2D2D2D" /><path d="M30 22L38 10L42 25" fill="#2D2D2D" />
                                <path d="M22 15L25 22L20 20" fill="#FFB7B7" opacity="0.6" /><path d="M38 15L35 22L40 20" fill="#FFB7B7" opacity="0.6" />
                                <circle cx="24" cy="35" r="2.5" fill="#EAB308" className="cat-eye" /><circle cx="36" cy="35" r="2.5" fill="#EAB308" className="cat-eye" />
                                <circle cx="24.5" cy="34.5" r="1" fill="black" /><circle cx="36.5" cy="34.5" r="1" fill="black" />
                                <circle cx="30" cy="40" r="1.5" fill="#FFB7B7" />
                                <path className="cat-tongue" d="M28 44Q30 48 32 44" fill="#FFB7B7" opacity="0" />
                            </g>
                        </g>
                    </svg>
                </div>
            </div>
        );

        function App() {
            const [tasks, setTasks] = useState([]);
            const [currentMonth, setCurrentMonth] = useState(new Date().getMonth());
            const [currentYear, setCurrentYear] = useState(new Date().getFullYear());
            const [currentWeek, setCurrentWeek] = useState(1);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [editingTaskId, setEditingTaskId] = useState(null);
            const [taskForm, setTaskForm] = useState({ title: '', day: 'Segunda', period: 'manha' });
            const [draggedTaskId, setDraggedTaskId] = useState(null);

            // Carregar do Local Storage ao iniciar
            useEffect(() => {
                const savedTasks = localStorage.getItem('cozy_tasks');
                if (savedTasks) {
                    try {
                        setTasks(JSON.parse(savedTasks));
                    } catch (e) {
                        console.error("Erro ao carregar LocalStorage:", e);
                    }
                }
            }, []);

            // Salvar no Local Storage sempre que as tarefas mudarem
            useEffect(() => {
                localStorage.setItem('cozy_tasks', JSON.stringify(tasks));
            }, [tasks]);

            const filteredTasks = useMemo(() => tasks.filter(t => 
                t.month === currentMonth && t.year === currentYear && t.week === currentWeek
            ), [tasks, currentMonth, currentYear, currentWeek]);

            const handleSave = () => {
                if (!taskForm.title.trim()) return;

                if (editingTaskId) {
                    setTasks(prev => prev.map(t => t.id === editingTaskId ? { ...t, ...taskForm } : t));
                } else {
                    const newTask = {
                        ...taskForm,
                        id: crypto.randomUUID(),
                        month: currentMonth,
                        year: currentYear,
                        week: currentWeek,
                        updatedAt: Date.now()
                    };
                    setTasks(prev => [...prev, newTask]);
                }
                setIsModalOpen(false);
            };

            const handleDuplicate = (t) => {
                const newTask = {
                    ...t,
                    id: crypto.randomUUID(),
                    updatedAt: Date.now()
                };
                setTasks(prev => [...prev, newTask]);
            };

            const handleDelete = (id) => {
                setTasks(prev => prev.filter(t => t.id !== id));
                setIsModalOpen(false);
            };

            const onDragStart = (e, id) => {
                setDraggedTaskId(id);
                e.dataTransfer.setData('taskId', id);
            };

            const onDrop = (e, day) => {
                const id = e.dataTransfer.getData('taskId');
                setTasks(prev => prev.map(t => t.id === id ? { ...t, day } : t));
                setDraggedTaskId(null);
            };

            const getCardStyle = (p) => {
                if(p === 'manha') return 'bg-[#E0F2FE] border-[#BAE6FD] text-[#0369A1]';
                if(p === 'tarde') return 'bg-[#FFEDD5] border-[#FED7AA] text-[#9A3412]';
                return 'bg-[#1E293B] border-[#334155] text-[#F8FAFC]';
            };

            return (
                <div className="min-h-screen p-4 flex flex-col h-screen relative">
                    <header className="flex flex-col md:flex-row items-center justify-between mb-4 gap-4 px-2">
                        <div className="flex items-center gap-3">
                            <div className="bg-[#B8E2F2] p-2 rounded-xl shadow-sm border border-white"><IconCalendar /></div>
                            <h1 className="text-xl font-bold text-[#4F6F52]">Minha Agenda</h1>
                        </div>
                        <div className="flex items-center gap-3">
                            <div className="flex items-center bg-white/60 p-1.5 rounded-xl border border-white">
                                <button onClick={() => setCurrentMonth(m => m === 0 ? 11 : m - 1)} className="p-1 px-2 hover:bg-white rounded transition-colors">‹</button>
                                <div className="px-4 font-bold text-sm min-w-[140px] text-center">{MONTHS[currentMonth]} {currentYear}</div>
                                <button onClick={() => setCurrentMonth(m => m === 11 ? 0 : m + 1)} className="p-1 px-2 hover:bg-white rounded transition-colors">›</button>
                            </div>
                            <div className="flex gap-1 bg-[#E8DFCA]/30 p-1 rounded-xl">
                                {[1, 2, 3, 4].map(w => (
                                    <button key={w} onClick={() => setCurrentWeek(w)} className={`px-3 py-1 rounded-lg text-xs font-bold transition-all ${currentWeek === w ? 'bg-white text-[#4F6F52] shadow-sm' : 'text-[#8A817C] hover:bg-white/40'}`}>Q{w}</button>
                                ))}
                            </div>
                        </div>
                    </header>

                    <main className="flex-1 overflow-x-auto pb-16">
                        <div className="flex gap-3 min-w-[1100px] h-full">
                            {DAYS_OF_WEEK.map(day => (
                                <div 
                                    key={day} 
                                    onDragOver={(e) => e.preventDefault()}
                                    onDrop={(e) => onDrop(e, day)}
                                    className="flex-1 min-w-[150px] bg-white/30 rounded-[1.5rem] border-2 border-[#E8DFCA] p-3 flex flex-col backdrop-blur-sm"
                                >
                                    <div className="flex justify-between items-center mb-3 px-1">
                                        <h2 className="font-bold text-sm">{day}</h2>
                                        <button 
                                            onClick={() => { setEditingTaskId(null); setTaskForm({title:'', day, period:'manha'}); setIsModalOpen(true); }} 
                                            className="w-6 h-6 bg-[#D4E7C5] rounded-full flex items-center justify-center hover:scale-110 active:scale-95 transition-all shadow-sm"
                                        >
                                            <IconPlus />
                                        </button>
                                    </div>
                                    <div className="flex-1 space-y-2 overflow-y-auto custom-scrollbar pr-1">
                                        {filteredTasks.filter(t => t.day === day).map(t => (
                                            <div 
                                                key={t.id} 
                                                draggable
                                                onDragStart={(e) => onDragStart(e, t.id)}
                                                onDoubleClick={() => { setEditingTaskId(t.id); setTaskForm({title:t.title, day:t.day, period:t.period}); setIsModalOpen(true); }} 
                                                className={`group relative p-3 rounded-2xl border shadow-sm transition-all hover:scale-[1.03] cursor-grab active:cursor-grabbing ${getCardStyle(t.period)} ${draggedTaskId === t.id ? 'opacity-20' : ''}`}
                                            >
                                                <div className="flex items-start gap-1">
                                                    <div className="mt-0.5 opacity-20 group-hover:opacity-100 transition-opacity">
                                                        <IconGrip />
                                                    </div>
                                                    <p className="text-xs font-bold break-words pr-5">{t.title}</p>
                                                </div>
                                                <button 
                                                    onClick={(e) => { e.stopPropagation(); handleDuplicate(t); }} 
                                                    className="absolute top-1 right-1 opacity-0 group-hover:opacity-100 bg-black/5 hover:bg-black/10 p-1 rounded transition-all"
                                                    title="Duplicar"
                                                >
                                                    <IconCopy size={10} />
                                                </button>
                                            </div>
                                        ))}
                                        {filteredTasks.filter(t => t.day === day).length === 0 && (
                                            <div className="flex flex-col items-center justify-center h-20 opacity-10 select-none">
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17.5 19L19 20.5L22 17.5"/><path d="M16 18c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h11c1.1 0 2 .9 2 2v7"/><path d="M7 8h10"/><path d="M7 12h10"/><path d="M7 16h5"/></svg>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </main>

                    <FancyCat />

                    {isModalOpen && (
                        <div className="fixed inset-0 bg-[#5D534A]/30 backdrop-blur-sm flex items-center justify-center p-4 z-[100]">
                            <div className="bg-white rounded-[2rem] p-8 w-full max-w-sm border-[4px] border-[#F9F3CC] shadow-2xl">
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="font-bold text-[#4F6F52] text-lg">{editingTaskId ? 'Editar' : 'Nova'} Atividade</h3>
                                    {editingTaskId && <button onClick={() => handleDelete(editingTaskId)} className="p-2 text-red-400 hover:bg-red-50 rounded-xl transition-colors"><IconTrash /></button>}
                                </div>
                                <div className="space-y-4">
                                    <input 
                                        autoFocus 
                                        value={taskForm.title} 
                                        onChange={e => setTaskForm({...taskForm, title: e.target.value})} 
                                        className="w-full bg-[#FDF6EC] border-2 border-[#E8DFCA] rounded-xl px-4 py-3 focus:outline-none focus:border-[#D4E7C5]" 
                                        placeholder="O que vamos fazer?" 
                                        onKeyDown={e => e.key === 'Enter' && handleSave()}
                                    />
                                    <div className="grid grid-cols-3 gap-2">
                                        {PERIODS.map(p => (
                                            <button 
                                                key={p.id} 
                                                onClick={() => setTaskForm({...taskForm, period: p.id})} 
                                                className={`p-3 border-2 rounded-xl text-[10px] font-bold transition-all ${taskForm.period === p.id ? 'border-[#D4E7C5] bg-[#D4E7C5]/10 text-[#4F6F52]' : 'border-[#E8DFCA] opacity-50'}`}
                                            >
                                                {p.label}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                <div className="flex gap-3 mt-8">
                                    <button onClick={() => setIsModalOpen(false)} className="flex-1 font-bold text-[#8A817C] hover:bg-[#FDF6EC] py-3 rounded-xl transition-colors">Voltar</button>
                                    <button onClick={handleSave} className="flex-[2] bg-[#D4E7C5] text-[#4F6F52] p-3 rounded-xl font-bold shadow-sm hover:bg-[#B5C99A] active:scale-95 transition-all">
                                        {editingTaskId ? 'Guardar' : 'Agendar'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
