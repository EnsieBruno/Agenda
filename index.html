<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Agenda</title>
    
    <!-- Tailwind CSS para Estilização -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React e ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel para transpilar JSX no navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Fontes Google -->
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #FDF6EC;
            overflow: hidden;
            margin: 0;
        }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #E8DFCA; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #D4E7C5; }

        /* Animações do Gato Mascote */
        .cat-svg { animation: idle-float 4s ease-in-out infinite; }
        .cat-tail-wag { animation: tail-wag 2s ease-in-out infinite alternate; transform-origin: left; }
        .cat-eye { animation: blink 5s infinite; }
        .cat-body-group { animation: cat-cycle 15s infinite; transform-origin: center center; }
        .cat-tongue { animation: tongue-lick 15s infinite; }
        .speech-bubble { animation: bubble-fade 8s infinite; }

        @keyframes idle-float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        @keyframes tail-wag {
            from { transform: rotate(-10deg); }
            to { transform: rotate(10deg); }
        }
        @keyframes blink {
            0%, 90%, 100% { transform: scaleY(1); }
            95% { transform: scaleY(0.1); }
        }
        @keyframes bubble-fade {
            0%, 5%, 35%, 100% { opacity: 0; transform: translateY(5px) scale(0.8); }
            10%, 30% { opacity: 1; transform: translateY(0) scale(1); }
        }
        @keyframes tongue-lick {
            0%, 40%, 46%, 100% { opacity: 0; transform: translateY(0); }
            41%, 45% { opacity: 1; transform: translateY(2px); }
        }
        @keyframes cat-cycle {
            0%, 35% { transform: rotate(0) scale(1); }
            40%, 50% { transform: rotate(-5deg); }
            55%, 70% { transform: rotate(360deg) scale(1.1); }
            75%, 100% { transform: rotate(0) scale(1); }
        }
        * { -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Firebase SDK (v9+) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, onSnapshot, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // NOTA: No GitHub Pages, você deve substituir este objeto pelas suas credenciais reais do Firebase
        const firebaseConfig = window.__firebase_config ? JSON.parse(window.__firebase_config) : {
            apiKey: "SUA_API_KEY",
            authDomain: "SEU_PROJETO.firebaseapp.com",
            projectId: "SEU_PROJETO",
            storageBucket: "SEU_PROJETO.appspot.com",
            messagingSenderId: "ID_MESSAGING",
            appId: "ID_APP"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = window.__app_id || 'cozy-planner-app';

        // Exportando para o escopo global para que o React possa acessar
        window.firebaseRefs = { auth, db, appId, signInAnonymously, onAuthStateChanged, collection, doc, setDoc, onSnapshot, deleteDoc };
    </script>

    <!-- Código React em JSX -->
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // Ícones em SVG inline para evitar dependências externas complexas
        const IconCalendar = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>;
        const IconPlus = ({size=14}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;
        const IconCopy = ({size=11}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>;
        const IconTrash = ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>;
        const IconPencil = ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>;

        const DAYS_OF_WEEK = ['Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado', 'Domingo'];
        const MONTHS = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
        const PERIODS = [
            { id: 'manha', label: 'Manhã', color: '#E0F2FE' },
            { id: 'tarde', label: 'Tarde', color: '#FFEDD5' },
            { id: 'noite', label: 'Noite', color: '#1E293B' }
        ];

        const FancyCat = () => (
            <div className="fixed bottom-4 right-8 pointer-events-none z-50 flex flex-col items-center">
                <div className="speech-bubble mb-2 px-4 py-2 bg-white rounded-2xl shadow-md border-2 border-[#E8DFCA] text-xs font-bold text-[#5D534A] relative">
                    Miau Miau! ✨
                    <div className="bubble-tail absolute -bottom-2 left-1/2 -translate-x-1/2 w-3 h-3 bg-white border-r-2 border-b-2 border-[#E8DFCA] rotate-45"></div>
                </div>
                <div className="cat-wrapper scale-125">
                    <svg width="100" height="80" viewBox="0 0 100 80" fill="none" className="cat-svg">
                        <ellipse cx="50" cy="70" rx="25" ry="5" fill="black" fillOpacity="0.05" />
                        <g className="cat-body-group">
                            <path className="cat-tail-wag" d="M70 50C85 50 90 40 85 30" stroke="#2D2D2D" strokeWidth="6" strokeLinecap="round" fill="none"/>
                            <rect x="25" y="40" width="50" height="25" rx="12" fill="#2D2D2D" />
                            <circle cx="35" cy="65" r="4" fill="#2D2D2D" /><circle cx="45" cy="65" r="4" fill="#2D2D2D" />
                            <circle cx="55" cy="65" r="4" fill="#2D2D2D" /><circle cx="65" cy="65" r="4" fill="#2D2D2D" />
                            <g className="cat-head-group">
                                <circle cx="30" cy="35" r="15" fill="#2D2D2D" />
                                <path d="M18 25L22 10L30 22" fill="#2D2D2D" /><path d="M30 22L38 10L42 25" fill="#2D2D2D" />
                                <path d="M22 15L25 22L20 20" fill="#FFB7B7" opacity="0.6" /><path d="M38 15L35 22L40 20" fill="#FFB7B7" opacity="0.6" />
                                <circle cx="24" cy="35" r="2.5" fill="#EAB308" className="cat-eye" /><circle cx="36" cy="35" r="2.5" fill="#EAB308" className="cat-eye" />
                                <circle cx="24.5" cy="34.5" r="1" fill="black" /><circle cx="36.5" cy="34.5" r="1" fill="black" />
                                <circle cx="30" cy="40" r="1.5" fill="#FFB7B7" />
                                <path className="cat-tongue" d="M28 44Q30 48 32 44" fill="#FFB7B7" opacity="0" />
                            </g>
                        </g>
                    </svg>
                </div>
            </div>
        );

        function App() {
            const [user, setUser] = useState(null);
            const [tasks, setTasks] = useState([]);
            const [currentMonth, setCurrentMonth] = useState(new Date().getMonth());
            const [currentYear, setCurrentYear] = useState(new Date().getFullYear());
            const [currentWeek, setCurrentWeek] = useState(1);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [editingTaskId, setEditingTaskId] = useState(null);
            const [taskForm, setTaskForm] = useState({ title: '', day: 'Segunda', period: 'manha' });

            useEffect(() => {
                const checkFirebase = setInterval(() => {
                    if (window.firebaseRefs) {
                        clearInterval(checkFirebase);
                        const { auth, signInAnonymously, onAuthStateChanged } = window.firebaseRefs;
                        signInAnonymously(auth).catch(e => console.error("Erro Auth:", e));
                        onAuthStateChanged(auth, setUser);
                    }
                }, 100);
                return () => clearInterval(checkFirebase);
            }, []);

            useEffect(() => {
                if (!user || !window.firebaseRefs) return;
                const { db, appId, collection, onSnapshot } = window.firebaseRefs;
                const tasksCollection = collection(db, 'artifacts', appId, 'users', user.uid, 'tasks');
                const unsubscribe = onSnapshot(tasksCollection, (snapshot) => {
                    setTasks(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                });
                return () => unsubscribe();
            }, [user]);

            const filteredTasks = useMemo(() => tasks.filter(t => 
                t.month === currentMonth && t.year === currentYear && t.week === currentWeek
            ), [tasks, currentMonth, currentYear, currentWeek]);

            const handleSave = async () => {
                if (!taskForm.title.trim() || !user) return;
                const { db, appId, doc, setDoc } = window.firebaseRefs;
                const id = editingTaskId || crypto.randomUUID();
                await setDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'tasks', id), {
                    ...taskForm, id, month: currentMonth, year: currentYear, week: currentWeek, updatedAt: Date.now()
                });
                setIsModalOpen(false);
            };

            const handleDelete = async (id) => {
                if (!user) return;
                const { db, appId, doc, deleteDoc } = window.firebaseRefs;
                await deleteDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'tasks', id));
                setIsModalOpen(false);
            };

            const getCardStyle = (p) => {
                if(p === 'manha') return 'bg-[#E0F2FE] border-[#BAE6FD] text-[#0369A1]';
                if(p === 'tarde') return 'bg-[#FFEDD5] border-[#FED7AA] text-[#9A3412]';
                return 'bg-[#1E293B] border-[#334155] text-[#F8FAFC]';
            };

            return (
                <div className="min-h-screen p-4 flex flex-col h-screen">
                    <header className="flex flex-col md:flex-row items-center justify-between mb-4 gap-4 px-2">
                        <div className="flex items-center gap-3">
                            <div className="bg-[#B8E2F2] p-2 rounded-xl shadow-sm border border-white"><IconCalendar /></div>
                            <h1 className="text-xl font-bold text-[#4F6F52]">Minha Agendar</h1>
                        </div>
                        <div className="flex items-center gap-3">
                            <div className="flex items-center bg-white/60 p-1.5 rounded-xl border border-white">
                                <button onClick={() => setCurrentMonth(m => m === 0 ? 11 : m - 1)} className="p-1">‹</button>
                                <div className="px-4 font-bold text-sm min-w-[140px] text-center">{MONTHS[currentMonth]} {currentYear}</div>
                                <button onClick={() => setCurrentMonth(m => m === 11 ? 0 : m + 1)} className="p-1">›</button>
                            </div>
                            <div className="flex gap-1 bg-[#E8DFCA]/30 p-1 rounded-xl">
                                {[1, 2, 3, 4].map(w => (
                                    <button key={w} onClick={() => setCurrentWeek(w)} className={`px-3 py-1 rounded-lg text-xs font-bold ${currentWeek === w ? 'bg-white text-[#4F6F52]' : 'text-[#8A817C]'}`}>Q{w}</button>
                                ))}
                            </div>
                        </div>
                    </header>

                    <main className="flex-1 overflow-x-auto pb-16">
                        <div className="flex gap-3 min-w-[1100px] h-full">
                            {DAYS_OF_WEEK.map(day => (
                                <div key={day} className="flex-1 min-w-[150px] bg-white/30 rounded-[1.5rem] border-2 border-[#E8DFCA] p-3 flex flex-col">
                                    <div className="flex justify-between mb-3">
                                        <h2 className="font-bold text-sm">{day}</h2>
                                        <button onClick={() => { setEditingTaskId(null); setTaskForm({title:'', day, period:'manha'}); setIsModalOpen(true); }} className="w-6 h-6 bg-[#D4E7C5] rounded-full flex items-center justify-center"><IconPlus /></button>
                                    </div>
                                    <div className="flex-1 space-y-2 overflow-y-auto custom-scrollbar">
                                        {filteredTasks.filter(t => t.day === day).map(t => (
                                            <div key={t.id} onDoubleClick={() => { setEditingTaskId(t.id); setTaskForm({title:t.title, day:t.day, period:t.period}); setIsModalOpen(true); }} className={`group relative p-3 rounded-2xl border shadow-sm transition-all hover:scale-[1.03] ${getCardStyle(t.period)}`}>
                                                <p className="text-xs font-bold break-words pr-5">{t.title}</p>
                                                <button onClick={() => { const {id, ...rest} = t; setTaskForm({...rest}); handleSave(); }} className="absolute top-1 right-1 opacity-0 group-hover:opacity-100 bg-black/5 p-1 rounded"><IconCopy /></button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </main>

                    <FancyCat />

                    {isModalOpen && (
                        <div className="fixed inset-0 bg-[#5D534A]/30 backdrop-blur-sm flex items-center justify-center p-4 z-[100]">
                            <div className="bg-white rounded-[2rem] p-8 w-full max-w-sm border-[4px] border-[#F9F3CC]">
                                <div className="flex justify-between mb-6">
                                    <h3 className="font-bold text-[#4F6F52]">{editingTaskId ? 'Editar' : 'Nova'} Atividade</h3>
                                    {editingTaskId && <button onClick={() => handleDelete(editingTaskId)} className="text-red-400"><IconTrash /></button>}
                                </div>
                                <input autoFocus value={taskForm.title} onChange={e => setTaskForm({...taskForm, title: e.target.value})} className="w-full bg-[#FDF6EC] border-2 border-[#E8DFCA] rounded-xl px-4 py-3 mb-4" placeholder="O que vamos fazer?" />
                                <div className="grid grid-cols-3 gap-2 mb-6">
                                    {PERIODS.map(p => (
                                        <button key={p.id} onClick={() => setTaskForm({...taskForm, period: p.id})} className={`p-2 border-2 rounded-xl text-[10px] font-bold ${taskForm.period === p.id ? 'border-[#D4E7C5] bg-[#D4E7C5]/10' : 'opacity-50'}`}>{p.label}</button>
                                    ))}
                                </div>
                                <div className="flex gap-2">
                                    <button onClick={() => setIsModalOpen(false)} className="flex-1 font-bold text-[#8A817C]">Voltar</button>
                                    <button onClick={handleSave} className="flex-[2] bg-[#D4E7C5] p-3 rounded-xl font-bold">Salvar</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
